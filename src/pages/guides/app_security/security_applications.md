# Security Application Manager {/*security-application-manager*/}

A Security Application Manager configuration:

-   [Identifies the set of traffic](#TrafficIdentification) to which it
    applies by hostname, a URL path, or both.

-   Defines how [threats will be detected](#ThreatDetection) via:

    -   **Access Rules:** An access rule identifies legitimate
        traffic and threats through access control lists.

    -   **Rate Rules:** A rate rule defines the rate of traffic
        that may be directed to one or more web sites.

    -   **Bot Rules:** A bot rule identifies traffic generated by
        basic bots by requiring clients to solve a browser challenge
        before serving content.

    -   **Custom Rules:** A custom rule identifies threats using
        custom criteria that takes into account your site's traffic
        profile to avoid false positives.

    -   **Managed Rules:** A managed rule identifies threats
        through threat detection policies.

-   Identifies how the above [rules are enforced](#Enforcement) on rate
    limited requests or threats .

    Each detected threat is logged regardless of enforcement action
    (i.e., block, custom response, redirect, or alert). View logged
    threats from the Threats, Rates, or Rate Enforcement dashboards.

    Standard security practices dictate that measures should be taken to
    prevent sensitive data (e.g., credit card information or passwords)
    from being passed as clear text from the client to your origin
    server. Another incentive for encrypting sensitive data is that it
    will be logged by our system when an alert is triggered as a result
    of this data. If sensitive data cannot be encrypted or obfuscated,
    then it is strongly recommended to contact our technical customer
    support to disable logging for the **Matched Value** field.

-   Allows you to keep your applications secure with known
    configurations and audit new access rules, custom rules, and managed
    rules without impacting production traffic. Use the Threats
    dashboard to isolate and analyze threats detected as a result of an
    audit of new access rules, custom rules, and managed rules.

    The ability to secure and audit your production traffic using
    separate configurations requires WAF Premier, WAF Standard, or
    WAF Essentials. If you currently have WAF Insights and would like to
    use this capability, please contact your CDN account manager to
    upgrade to the full version.

## Traffic Identification {/*traffic-identification*/}

Identify the set of traffic to which a Security Application Manager
configuration's rules will be applied by host, URL path, or both.

### Host {/*host*/}

By default, a Security Application Manager configuration applies to all
hosts. However, you may limit a Security Application Manager
configuration to one or more hosts. WAF compares the entire
`Host` header value against the specified value.

Key information:

-   The `Host` header identifies either a hostname or IP
    address using the following syntax: 

    ```
    *Host*

    *Host*:*Port*
    ```

-   The CDN only accepts HTTP/HTTPS requests on standard ports (i.e., 80
    and 443). Typically, a `Host` request header does not
    include port information for standard ports. However, the requesting
    user agent defines the `Host` request header submitted to
    the CDN.

-   For the purpose of this comparison, the hostname defined by this
    match condition will not be resolved to an IP address.

-   For the purpose of this comparison, a customer origin's **HTTP Host
    Header** option is irrelevant.

-   WAF supports various comparison modes (i.e., exact match, wildcard,
    and regular expression).

    [Learn more.](#MatchComparisonModes)

### URL Path {/*url-path*/}

By default, a Security Application Manager configuration applies to all
URL paths. However, you may limit a Security Application Manager
configuration to one or more URL paths. WAF compares the entire URL path
against the specified value.

Key information:

-   URL path comparisons start directly after the hostname.

```
/`path`/`asset`
```

**Example:** 

```
/marketing/brochures/widget.htm
```

-   A partial match does not count towards the rate limit.

**Example:** 

    Given the above sample configuration, the following request would
    not count towards the rate limit:

```
http://cdn.example.com/marketing/brochures/widget.html
```

-   WAF supports various comparison modes (i.e., exact match, wildcard,
    and regular expression).

    [Learn more.](#MatchComparisonModes)

### Match Comparison Modes {/*match-comparison-modes*/}

Your Security Application Manager configuration determines how WAF
compares a request's host or URL path against the specified value. The
available modes are listed below.

-   **Default:** WAF will not perform a comparison. It will apply
    the current Security Application Manager configuration to all hosts
    or URL paths.

-   [Exact match (multiple entries):](#EM) Use this mode to specify each
    desired value.

-   [Wildcard match:](#WildcardMatch) Use this mode to specify a
    wildcard pattern.

-   [Regex match:](#REGEX) Use this mode to specify a regular
    expression.

Wildcard and regular expression match comparison modes require WAF
Premier, WAF Standard, or WAF Essentials. If you currently have
WAF Insights and would like to use this capability, please contact your
CDN account manager to upgrade to the full version.

#### Exact Match (Multiple Entries) {/*exact-match-multiple-entries*/}

WAF compares the specified value(s) against the entire host or URL path.
It will only apply this Security Application Manager configuration to a
request when one of the specified value(s) is an exact match. This
comparison is case-sensitive.

Sample Configuration:

```
cat

bat
```

Matches:

```
cat

bat
```

Does Not Match:

```
Cat

Bat

Category

Moscato

Batch
```

#### Wildcard Match {/*wildcard-match*/}

WAF checks whether the entire host or URL path is a case-sensitive match
for the wildcard pattern. The supported set of wildcards are listed
below.

-------------| Wildcard    | Description | Example     | Matches    | Does Not  Match       |
| \*          | Matches zero or more characters.     | `cat\*`       | `cat`<br /><br />`category`<br /><br />`muscat` | `cAt`<br /><br />`Category`|
| ? | Matches a single character. | `cat?` | `cats`<br /><br />`muscats` | `Cats`<br /><br />`cat`|
| \[*abc*\]   | Matches a single character defined within the brackets. | `cat?` | `cats`<br /><br />`muscats` | `Cats`<br /><br />`cat` |
| \[*a*-*z*\] | Matches a single character from the specified range. | `[a-z]art` | `cart` <br /><br /> `mart` <br /><br /> `tart` | `Cart` <br /><br /> `marT` <br /><br /> `start` |
| \[!*abc*\]  | Matches a single character that is not defined within the brackets. |  `[!cm]art` | `Cart` <br /><br /> `Mart` <br /><br /> `tart` | `cart` <br /><br /> `mart` <br /><br /> `tArt` |
| [!*a*-*z*\] | Matches a single character that is excluded from the specified range. | `[!a-m]art` | `Cart` <br /><br /> `Mart` <br /><br /> `tart` | `cart` <br /><br /> `mart` <br /><br /> `tArt` |

<br /><br /> **Example:** 

Setting the `URL path(s)` option to the following value allows
WAF to apply this Security Application Manager configuration to any
request whose URL path starts with */marketing/*:

```
/marketing/\*
```

The following sample request will match the above pattern:

```
https://cdn.example.com/marketing/mycampaign/image.png
```

#### Regex Match {/*regex-match*/}

WAF checks whether the entire host or URL path is a match for the
pattern defined in a regular expression.

Regular expressions are case-sensitive.

**Sample Configuration:**

```
\^\[a-zA-Z0-9\]\*\$
```

**Matches:**

```
cat

CAT7

Category
```

**Does Not Match:**

```
Category 7

Cat#7
```

## Threat Detection {/*threat-detection*/}

Identify threats by adding the following rule(s) to your Security
Application Manager configuration:

-   **Access Rules:** An [access rule](Access-Rules.htm) identifies
    legitimate traffic and threats through access control lists.

-   **Rate Rules:** A [rate rule](Rate-Rules.htm) identifies
    malicious or unnecessary traffic through traffic patterns.

    <a id="RateLimits"></a>Requests that originate from rate limited clients
    will not count towards the rate limit. Upon the expiration of the
    time period defined in the **Time period** option, we will
    resume counting these requests. If the client exceeds the rate limit
    again, then this action will be reapplied to it for the duration
    defined by this option.

    A \"client\" is defined by each rule according to the rate rule's
    **Apply rate limit to** option. For example, configuring that
    option to [Any request]{.listitem} will apply the selected action to
    all requests regardless of the number of requests generated by each
    device. Alternatively, identifying clients by [IP
    address]{.listitem} will only apply the selected action to requests
    that originate from each IP address that violates the specified rate
    limit.

-   **Bot Rules:** A [bot rule](Bot-Rules.htm) identifies traffic
    generated by basic bots by requiring clients to solve a browser
    challenge before serving content.

-   **Custom Rules:** A [custom rule](Custom-Rules.htm) identifies
    threats using custom criteria that takes into account your site's
    traffic profile to avoid false positives.

-   **Managed Rules:** A [managed rule](Managed-Rules.htm)
    identifies threats through threat detection policies.

<a id="enforcementmode"></a>You may apply an access, custom, or managed rule in
one of the following modes:

-   **Production:** This mode secures your application by allowing
    you to choose from a variety of actions through which your security
    policy will be [enforced](#Enforcement).

-   **Audit:** This mode allows you to test new security policies
    without impacting production traffic. Requests that are identified
    as threats are logged. Use the Threats dashboard to analyze detected
    threats and check for false positives. You should apply this
    security policy to production traffic once you are confident that it
    will generate minimal false positives.

    Rate and bot rules may only run in production mode. You cannot run
    them in audit mode.

Auditing a profile that is already being applied to production traffic
will cause the same threat to be logged twice.

## Enforcement {/*enforcement*/}

You may customize how rules that run in [production
mode](#enforcementmode) will be enforced. Enforcement is triggered when:

-   A threat is detected when the security policy defined within an
    access rule, bot rule, custom rule, or managed rule is violated.
-   A rate limit defined within a rate rule is exceeded.

WAF will only generate alerts for rules that run in audit mode. This
enforcement action cannot be customized.

Rate and bot rules may only run in production mode. You cannot run them
in audit mode.

The available enforcement actions are described below.

| Mode                | Description                                   |
| ----------- | ----------- |
| Alert Only          | Rate limited requests or detected threats will only generate an alert.  Our recommendation for testing new configurations is to use [audit mode](#enforcementmode) instead of applying the `Alert Only` enforcement action to a rule running in production mode.  WAF applies a single enforcement action per mode (i.e., [production or audit](#enforcementmode)). Once enforcement is triggered for that mode, WAF does not perform further [evaluation of that request](Configuration.htm#Threat). If you are setting up a rule in production mode, we recommend that you limit your use of the `Alert Only` enforcement to the shortest amount of time necessary to validate changes to your configuration.  Use this mode to track detected threats through the dashboard without impacting production traffic.                           |
| Block Request       | Access Rules, Custom Rules, and Managed Rules  Detected threats will be dropped and the client will receive a `403 Forbidden` response.             |
| Custom Response     | Rate limited requests or detected threats will receive a custom response.  -   **Response Body:** Define the payload that will be delivered to the client in response to a detected threat.  This option supports the use of [event variables](#Event) to customize the response according to the detected threat.  Sample payload for a CSS file:  `body {  background-color: #ffffff;  }`  Configure whether the response body will consist of a default error page or the value defined in the **Response body** option.  -   **Display Default Error Page:** Mark this option to respond to detected threats with a web page that describes the detected threat. Specifically, it will indicate the client's IP address, the requested URL, and the date/time at which the request was screened.  This option does not control the status code or the headers included in the response. Configure those settings through the **HTTP status code** and the **Custom response headers** options, respectively.  -   **Response Body:**  Setting a value in the **Response body** option will cause it to take precedence over the **Display Default Error Page** option.  -   **HTTP Status Code:** Defines the HTTP status code that will be sent to the client.  View a list of valid HTTP status codes.  -   100 -   101 -   102 -   200 -   201 -   202 -   203 -   204 -   205 -   206 -   207 -   208 -   226 -   300 -   301 -   302 -   303 -   304 -   305 -   306 -   307 -   308 -   400 -   401 -   402 -   403 -   404 -   405 -   406 -   407 -   408 -   409 -   410 -   411 -   412 -   413 -   414 -   415 -   416 -   417 -   421 -   422 -   423 -   424 -   426 -   428 -   429 -   431 -   451 -   500 -   501 -   502 -   503 -   504 -   505 -   507 -   508 -   509 -   510 -   511  -   **Custom Response Headers:** Defines one or more response headers that will be sent to the client. Define each custom response header on a separate line.  <br /><br /> **Syntax:**   <br /><br />`Name<br /><br />`:<br /><br />`Value`<br /><br /> <br /><br /> **Example:**   <br /><br />`MyCustomHeader: True`<br /><br /> This option supports the use of [event variables](#Event) to customize the response according to the detected threat.  All characters, including spaces, defined before or after the colon will be treated as a part of the specified header name or value, respectively.                      |
| Drop Connection     | The connection for rate limited requests will be silently dropped. No response will be provided to the client.  This action is only recommended for known malicious traffic. This action prevents the malicious client from knowing whether the attack reached its intended target. However, if this approach is applied to legitimate traffic, then those clients will be unable to reach your site.                              |
| Drop request        | Rate Rules Only  Rate limited requests will be dropped and the client will receive the following response:  -   **HTTP status code: **`503 Service Unavailable` -   **Response header: **`Retry-After: 10 seconds`  The `Retry-After` response header provides a hint to the client as to when service may resume.                           |
| Redirect (HTTP 302) | Rate limited requests or detected threats will be redirected to the specified URL.  Key information:  -   The HTTP status code for this response will be a `302 Found`.  -   Set the **URL** option to the full URL to which rate limited requests or detected threats will be redirected.  <br /><br /> **Example:** <br /><br /> `http://cdn.mydomain.com/marketing/busy.html`                                       |

### Event Variables {/*event-variables*/}

A custom response header value or a custom response body may include
variables that describe the event. These variables are described below.

| Variable    | Description                                           |
| ----------- | ----------- |
| EVENT_ID    | Represents the system-defined ID assigned to the request that was identified as a threat.  Find out detailed information about the detected threat by passing this ID to the Get Event Log Entry endpoint (REST API).\ [Learn more .](https://%5B%=Domains.RAHC%%5D/index.html#Media_Man agement/WAF/Get-Event-Log-Entry.htm){target="_blank"} |
| CLIENT_IP   | Represents the IP address of the device that submitted the detected threat.                        |
| TIMESTAMP   | Represents the date and time at which the detected threat was submitted.                                 |
| REQUEST_URL | Represents the URL for the request that was deemed a threat.                                               |

Add an event variable to a custom response header value or a custom
response body by enclosing it with double curly braces.

**Example:** 

```
{{EVENT_ID}}
```

## Order of Precedence {/*order-of-precedence*/}

The recommended practice is to create a Security Application Manager
configuration that is tuned for each of your applications. This allows
you to apply a restrictive security policy with minimal false positives.
Each Security Application Manager configuration's host and URL path
conditions determine the set of traffic to which it may be applied. If a
request is eligible to be screened by multiple Security Application
Manager configurations, then WAF will screen it using the first eligible
configuration in the list.

Reorder Security Application Manager configurations by dragging the
desired configuration's ![](/images/icons/drag.png)
icon to the desired position.

## Security Application Manager Administration {/*security-application-manager-administration*/}

You may create, modify, and delete Security Application Manager
configurations.

Key information:

-   Administer Security Application Manager configurations from the
    [[Security Application Manager
    page](https://%5B%=Domains.Portal%%5D/Defend/ApplicationManager#/defend/waf/config-manager){target="_blank"
    madcap:conditions="General.EdgeCast,General.TransactOnly"
    madcap:excludeaction="unbind"}]{.portal}.

-   Identify the set of traffic (e.g., all requests or by customer
    origin) to which your security policy will be applied by balancing
    the need to secure as much traffic as possible with the level of
    restrictive measures imposed by it.

    The recommended approach is to apply the most restrictive policy to
    as much traffic as possible while causing minimal impact to data
    delivery.

-   Apply [access rules](Access-Rules.htm), [rate
    rules](Rate-Rules.htm), [bot rules](Bot-Rules.htm), [custom
    rules](Custom-Rules.htm), and [managed rules](Managed-Rules.htm) to
    production traffic by adding it to a Security Application Manager
    configuration and then determining how it will be enforced.

    Rules are administered independently from Security Application
    Manager configurations. This allows you to use the same rule within
    multiple Security Application Manager configurations. Leverage this
    capability to tailor security screening by application or traffic
    profile.

-   Use [audit mode](#ThreatDetection) to verify that new access rules,
    custom rules, and managed rules will not generate substantial false
    positives.

-   It may take up to 2 minutes for an updated Security Application
    Manager configuration to be applied across our entire network.

To create a Security Application Manager configuration

1.  

2.  Click **Add New**.

3.  In the **Name** option, type the unique name by which this
    Security Application Manager configuration will be identified.

4.  Optional. Identify the set of traffic to which this security policy
    will be applied by defining a hostname and/or URL path through the
    **Hostname** and **URL path(s)** options.

    Select one of the following modes:

    -   **Default:** Use this mode to apply this Security
        Application Manager configuration regardless of the request's
        host or URL path.

    -   **Exact match (multiple entries):** Use this mode to apply
        this Security Application Manager configuration to the specified
        hostname(s) or URL path(s).

        [Learn more.](#EM)

    -   **Wildcard match:** Use this mode to apply this Security
        Application Manager configuration to all hostnames or URL paths
        that satisfy the specified wildcard pattern.

        [Learn more.](#WildcardMatch)

    -   **Regex match:** Use this mode to apply this Security
        Application Manager configuration to all hostnames or URL paths
        that satisfy the specified regular expression pattern.

        [Learn more.](#REGEX)

    Enable the **Negative match** option to configure a Security
    Application Manager configuration to look for requests that do not
    match the specified value or pattern.

5.  Optional. Select an access rule through which production traffic
    will be screened and determine how threats identified by it are
    handled.

    If you have not already created the desired access rule, you can
    save your Security Application Manager configuration, [create an
    access rule](Access-Rules.htm#AccessRuleAdministration), edit your
    Security Application Manager configuration, and then resume this
    procedure.

    i.  From the **Rules** section, click **Access Rule**.

    ii. From the **Production Access Rule** option, select the
        desired access rule.

    iii. Optional. From the **Action name** option, type a name
         that describes the enforcement action configuration.

    iv. From the **Action type** option, determine how threats
        identified by the access rule selected in step ii will be
        handled (i.e., block, alert, redirect, or send a custom
        response).

        [Learn more.](#Enforcement)

6.  Optional. [Audit production traffic](#ThreatDetection) using a new
    access rule.

    i.  From the **Rules** section, click **Access Rule**.
    ii. From the **Audit Access Rule** option, select the desired
        access rule.

    Filter the Threats dashboard by the above access rule or the
    *audit* profile type to track detected threats.

    Disable auditing by setting the **Audit Managed Rule** option
    to *No Audit Rule*.

7.  Optional. Select a rate rule through which production traffic will
    be rate limited.

    If you have not already created the desired rate rule, you can save
    your Security Application Manager configuration, [create a rate
    rule](Rate-Rules.htm#RateRuleAdministration), edit your Security
    Application Manager configuration, and then resume this procedure.

    i.  From the **Rules** section, click **Rate Rules**.

    ii. From the **Add Rate Rule** option, select the desired
        rate rule.

        If the selected rate rule contains a condition group, then a
        request must satisfy the Security Application Manager
        configuration's host and URL path match conditions and all of
        the conditions within at least one condition group in order to
        be eligible for rate limiting.

    iii. Optional. From the **Action name** option, type a name
         that describes the enforcement action configuration.

    iv. From the **Action type** option, determine how threats
        identified by the managed rule selected in step ii will be
        handled (i.e., drop request, alert, redirect, or send a custom
        response).

        [Learn more.](#Enforcement)

        WAF does not perform further [evaluation of a
        request](Configuration.htm#Threat) once enforcement is
        triggered. For this reason, we recommend that you limit your use
        of the `Alert Only` enforcement to the shortest amount
        of time necessary to validate changes to your configuration.

    v.  From the **Time period** option, select the time period
        for which the action selected in the next step will be applied
        to clients that exceed the rate limit defined in the rate rule
        selected in step ii.

        A \"client\" is defined by each rate rule according to the
        **Apply rate limit to** option. For example, configuring
        that option to [Any request]{.listitem} will apply the selected
        action to all requests regardless of the number of requests
        generated by each device. Alternatively, identifying clients by
        [IP Address]{.listitem} will only apply the selected action to
        requests that originate from each IP address that violates the
        specified rate limit.

    vi. If you would like to apply an additional rate limit, then repeat
        steps ii - v.

        Use multiple rate rules to apply different rate limits to
        various traffic profiles. Set up this type of configuration
        using either a single or multiple Security Application Manager
        configurations. If you assign multiple rate rules to a single
        Security Application Manager configuration, then each rate rule
        should contain one or more [condition
        group(s)](Rate-Rules.htm#ConditionGroup).

8.  <a id="botruleconfiguration"></a>Optional. Select a bot rule that identifies
    the set of production traffic to which a browser challenge will be
    applied.

    If you have not already created the desired bot rule, you can save
    your Security Application Manager configuration, [create a bot
    rule](Bot-Rules.htm#BotRuleAdministration), edit your Security
    Application Manager configuration, and then resume this procedure.

    i.  From the **Rules** section, click **Bot Rule**.

    ii. From the **Production Bot Rule** option, select the
        desired bot rule.

    iii. Optional. From the **Action type** option, verify that
         it is set to [Browser Challenge]{.listitem}.

    iv. Optional. From the **Action status** option, determine
        the HTTP status code for the response provided to clients that
        are being served the browser challenge.

    v.  Optional. From the **Valid for (in minutes)** option,
        type the number of minutes for which our CDN will serve content
        to a client that solves a browser challenge without requiring an
        additional browser challenge to be solved. Specify a value
        between 1 and 1,440 minutes.

9.  Optional. Select a custom rule through which production traffic will
    be screened and determine how threats identified by it are handled.

    If you have not already created the desired custom rule, you can
    save your Security Application Manager configuration, [create a
    custom rule](Custom-Rules.htm#CustomRuleAdministration), edit your
    Security Application Manager configuration, and then resume this
    procedure.

    i.  From the **Rules** section, click **Custom Rule**.

    ii. From the **Production Custom Rule** option, select the
        desired custom rule.

    iii. Optional. From the **Action name** option, type a name
         that describes the enforcement action configuration.

    iv. From the **Action type** option, determine how threats
        identified by the custom rule selected in step ii will be
        handled (i.e., block, alert, redirect, or send a custom
        response).

        [Learn more.](#Enforcement)

10. Optional. [Audit production traffic](#ThreatDetection) using a new
    custom rule.

    i.  From the **Rules** section, click **Custom Rule**.
    ii. From the **Audit Custom Rule** option, select the desired
        custom rule.

    Filter the Threats dashboard by the above custom rule or the
    *audit* profile type to track detected threats.

    Disable auditing by setting the **Audit Custom Rule** option
    to *No Audit Rule*.

11. Optional. Select a managed rule through which production traffic
    will be screened and determine how threats identified by it are
    handled.

    If you have not already created the desired manged rule, you can
    save your Security Application Manager configuration, [create a
    managed rule](Managed-Rules.htm#ManagedRuleAdministration), edit
    your Security Application Manager configuration, and then resume
    this procedure.

    i.  From the **Rules** section, click **Managed
        Rule**.

    ii. From the **Production Managed Rule** option, select the
        desired managed rule.

    iii. Optional. From the **Action name** option, type a name
         that describes the enforcement action configuration.

    iv. From the **Action type** option, determine how threats
        identified by the managed rule selected in step ii will be
        handled (i.e., block, alert, redirect, or send a custom
        response).

        [Learn more.](#Enforcement)

12. Optional. [Audit production traffic](#ThreatDetection) using a new
    managed rule.

    i.  From the **Rules** section, click **Managed
        Rule**.
    ii. From the **Audit Managed Rule** option, select the
        desired managed rule.

    Filter the Threats dashboard by the above managed rule or the
    *audit* profile type to track detected threats.

    Disable auditing by setting the **Audit Managed Rule** option
    to *No Audit Rule*.

13. Click **Save**.

14. Click **Apply All Changes**.

15. Click **Save Changes**.

To reorder Security Application Manager configurations

1.  From the **Security Application Manager**
    page, drag the desired
    configuration's ![](/images/icons/drag.png) icon
    to the desired position.
2.  Click **Apply All Changes**.
3.  Click **Save Changes**.

If multiple Security Application Manager configurations are applicable
to the same request, then consider updating their host or URL path
conditions to a more restrictive pattern.

Traffic is always screened using the first eligible Security Application
Manager configuration.

To modify a Security Application Manager configuration

1.  
2.  Click on the desired Security Application Manager configuration.
3.  Make the desired changes.
4.  Click **Save**.
5.  Click **Apply All Changes**.
6.  Click **Save Changes**.

To delete a Security Application Manager configuration

1.  
2.  Click on the desired Security Application Manager configuration.
3.  Click **Delete Security Application Manager**.
4.  Type *DELETE*.
5.  Click **Delete**.
6.  Click **Apply All Changes**.
7.  Click **Save Changes**.
